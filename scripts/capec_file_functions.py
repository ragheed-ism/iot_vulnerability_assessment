import pandas as pd

def clean_input_data(df: pd.DataFrame):
    # Rename the first column to "CVE"
    df.rename(columns={df.columns[0]:"CVE"}, inplace=True)

    # Clean the category names from any trailing spaces.
    df.columns = df.columns.str.strip()

    return df

def clean_cwe_dataframe(df_cve: pd.DataFrame):
    # Clean the input data 
    df_cve = clean_input_data(df_cve)

    # Get the categories found in the dataframe and put them in a list
    cve_categories = df_cve.columns.tolist()
    cve_categories.remove("CVE")
    cve_categories.sort()

    # Generate an id for every category and pu them in a dictionary & dataframe
    category_index = {k: v for v, k in enumerate(cve_categories)}
    df_category_index = pd.DataFrame(category_index.items(),columns=["category","id"])

    # Create an empty dataframe to be filled
    df_cve_final = pd.DataFrame()
    # Itterate over every category found in the dataframe
    for cat in cve_categories:
        # Create an empty dataframe for every category to be filled
        df_tmp = pd.DataFrame()

        # Get columns related to the category
        df_tmp = df_cve.loc[:,["CVE",cat]].dropna(how="any").rename(columns={cat:"CAPEC"})

        # Map the category to its id
        df_tmp["category_id"] = category_index[cat]

        # Split the CAPEC list into different rows
        df_tmp["CAPEC"] = df_tmp["CAPEC"].str.split(',')
        df_tmp = df_tmp.explode('CAPEC').reset_index(drop=True)
        df_tmp["CAPEC"] = df_tmp["CAPEC"].str.strip()

        # Concat the temporary dataframe to the final dataframe
        df_cve_final = pd.concat([df_cve_final,df_tmp])

    return df_category_index, df_cve_final